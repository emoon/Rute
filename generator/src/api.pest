chunk = _{ soi ~ structdef* ~ eoi }

structdef   =  { attributes? ~ traits? ~ name ~ derive? ~ ("{") ~ fieldlist? ~ ("}") }
fieldlist   =  { field ~ (fieldsep ~ field)* ~ fieldsep* }
field       =  { var | function }
fieldsep    = _{ (",") }

rettype     = { name }
attributes  = { ("#[attributes(") ~ namelist ~ (")]") }
traits      = { ("#[traits(") ~ namelist ~ (")]") }
derive      = { (":") ~ name }
callback    = { ("[callback]") }
event       = { ("[event]") }
manual      = { ("[manual]") }
refexp      = { ("&") }
retexp      = { ("->") ~ refexp? ~ vtype }
var         = { refexp? ~ vtype ~ name }
varlist     = { var ~ ((",") ~ var)* }
namelist    = { name ~ ((",") ~ name)* }
function    = { manual? ~ event? ~ callback? ~ name ~ ("(") ~ varlist? ~ (")") ~ retexp? }

name = @{
	(('a'..'z') | ('A'..'Z') | ("_")) ~ (('a'..'z') | ('A'..'Z') | ("_") | ('0'..'9'))*
}

vtype = @{
	(('a'..'z') | ('A'..'Z') | ("_")) ~ (('a'..'z') | ('A'..'Z') | ("_") | ('0'..'9'))*
}

comment = _{
	("//") ~ (!(("\r") | ("\n")) ~ any)* ~ (("\n") | ("\r\n") | ("\r") | eoi)
}

whitespace = _{ (" ") | ("\t") | ("\u{000C}") | ("\r") | ("\n") }

